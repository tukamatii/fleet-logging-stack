# fleet.yaml
defaultNamespace: promtail

namespaceLabels:
  okbtsp.corp/department: OIT
  okbtsp.corp/owner: baranav
  okbtsp.corp/project: promtail
  pod-security.kubernetes.io/enforce: privileged
  pod-security.kubernetes.io/audit: privileged
  pod-security.kubernetes.io/warn: privileged

name: promtail

kustomize:
  dir: "full"

helm:
  chart: ./helm
  values:
    clusterName: ${ if hasKey .ClusterLabels "management.cattle.io/cluster-display-name" }${ get .ClusterLabels "management.cattle.io/cluster-display-name" }${ else }${ .ClusterName }${ end }

# Кастомизация под кластеры
targetCustomizations:
  # === MANAGEMENT ===
  - name: management
    clusterSelector:
      matchLabels:
        okbtsp.corp/template: rancher-k3s

  # === PROD ===
  - name: prod
    clusterSelector:
      matchLabels:
        okbtsp.corp/template: talos-vmware

dependsOn:
  - name: loki
